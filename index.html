<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The Loop – Performance</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: black;
      font-family: sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .slide {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    .slide.active { opacity: 1; z-index: 1; }

    video, img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .text {
      position: absolute;
      bottom: 6%;
      color: white;
      font-size: 5vw;
      font-weight: bold;
      text-align: center;
      padding: 0 5vw;
      line-height: 1.3;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }

    @media (orientation: landscape) {
      .text { font-size: 3vw; bottom: 4%; }
    }
  </style>
</head>
<body>

  <div class="slide" data-type="video" data-src="image1PERF.MP4" data-text="Every shift rewrites the standard."></div>
  <div class="slide" data-type="image" data-src="ProudmomentOEE.png" data-text="That’s what flow looks like." data-hold="15000"></div>
  <div class="slide" data-type="image" data-src="image3PERF.PNG" data-text="You don’t lose the line.\nYou’re handed a mess."></div>
  <div class="slide" data-type="video" data-src="image4PERF.MP4" data-text="Rejects don’t shout.\nThey slip through if we’re not watching."></div>
  <div class="slide" data-type="image" data-src="image5PERF.PNG" data-text="What’s next only works if we’re ready now."></div>
  <div class="slide" data-type="video" data-src="image6PERF.MP4" data-text="Every shift rewrites the standard.\nDay after day.\nYear after year."></div>

  <script>
    const slides = document.querySelectorAll('.slide');
    let index = 0;

    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function showSlide(slide) {
      const type = slide.dataset.type;
      const src = slide.dataset.src;
      const text = slide.dataset.text;
      const hold = slide.dataset.hold ? parseInt(slide.dataset.hold) : 7000;

      let mediaEl;

      if (type === 'video') {
        mediaEl = document.createElement('video');
        mediaEl.src = src;
        mediaEl.autoplay = true;
        mediaEl.playsInline = true;
        mediaEl.muted = true;
        mediaEl.style.opacity = '0';
        slide.appendChild(mediaEl);

        await delay(250); // buffer
        mediaEl.style.opacity = '1';
        await mediaEl.play();
        await new Promise(resolve => mediaEl.onended = resolve);
      }

      if (type === 'image') {
        mediaEl = document.createElement('img');
        mediaEl.src = src;
        mediaEl.style.opacity = '0';
        slide.appendChild(mediaEl);

        await delay(250);
        mediaEl.style.opacity = '1';
        await delay(hold);
      }

      // TYPE TEXT
      const textBox = document.createElement('div');
      textBox.className = 'text';
      slide.appendChild(textBox);

      await delay(250);

      textBox.style.opacity = '1';
      await typeText(textBox, text, 120);

      await delay(2500);
      textBox.style.opacity = '0';
      await delay(1000);
    }

    async function typeText(el, text, speed) {
      const lines = text.split('\n');
      el.innerHTML = '';
      for (const line of lines) {
        const p = document.createElement('div');
        el.appendChild(p);
        for (let i = 0; i < line.length; i++) {
          p.textContent += line[i];
          await delay(speed);
        }
        await delay(speed * 2);
      }
    }

    async function runSlides() {
      while (index < slides.length) {
        const current = slides[index];
        current.classList.add('active');
        await showSlide(current);
        current.classList.remove('active');
        current.innerHTML = '';
        index++;
      }
    }

    runSlides();
  </script>
</body>
</html>
